import { kv } from 'hub:kv'
import { parseMarkdown } from '@nuxtjs/mdc/runtime'

interface Note {
  body: string
  parsed?: object
}

export default eventHandler(async (event) => {
  const slug = 'index'

  let note = await kv.get<Note>(slug)

  // å¦‚æœæ²¡æœ‰é¦–é¡µ,åˆ›å»ºé»˜è®¤é¦–é¡µ
  if (!note) {
    const defaultContent = `---
title: W3C æŠ€æœ¯è”ç›Ÿ
description: åœ¨çº¿æŠ€æœ¯æ–‡æ¡£ç¼–è¾‘å™¨
tags: [ä»‹ç», æ–‡æ¡£]
---

# æ¬¢è¿ä½¿ç”¨ W3C æŠ€æœ¯è”ç›Ÿ

è¿™æ˜¯ä¸€ä¸ªåŠŸèƒ½å¼ºå¤§çš„åœ¨çº¿ Markdown æ–‡æ¡£ç¼–è¾‘å™¨ã€‚

## ä¸»è¦åŠŸèƒ½

### ğŸ” æœç´¢åŠŸèƒ½
- æ”¯æŒå…¨æ–‡æœç´¢
- å®æ—¶æœç´¢ç»“æœ
- æœç´¢æ ‡é¢˜å’Œå†…å®¹

### ğŸ“ åœ¨çº¿ç¼–è¾‘
- åŒå‡»ä»»æ„ä½ç½®å³å¯ç¼–è¾‘
- åˆ†å±é¢„è§ˆæ¨¡å¼
- Markdown å·¥å…·æ 
- è‡ªåŠ¨ä¿å­˜

### ğŸ“‘ æ–‡æ¡£å¯¼èˆª
- é¢åŒ…å±‘å¯¼èˆª
- ä¸Šä¸€ç¯‡/ä¸‹ä¸€ç¯‡
- ç›®å½•å¯¼èˆª

### ğŸ“Š é¡µé¢ä¿¡æ¯
- æ›´æ–°æ—¶é—´
- é˜…è¯»æ—¶é—´
- ä½œè€…ä¿¡æ¯
- æ ‡ç­¾åˆ†ç±»

## å¿«é€Ÿå¼€å§‹

1. ç‚¹å‡»å³ä¸Šè§’ "ç™»é™†" æŒ‰é’®
2. è¾“å…¥å¯†ç : \`123456\`
3. åŒå‡»ä»»æ„é¡µé¢å¼€å§‹ç¼–è¾‘
4. ä½¿ç”¨å·¥å…·æ æ’å…¥ Markdown å…ƒç´ 
5. ä¿å­˜æˆ–å–æ¶ˆç¼–è¾‘

## Markdown ç¤ºä¾‹

### ä»£ç å—

\`\`\`javascript
const greeting = 'Hello, World!'
console.log(greeting)
\`\`\`

### å¼•ç”¨

> è¿™æ˜¯ä¸€ä¸ªå¼•ç”¨å—

### åˆ—è¡¨

- é¡¹ç›® 1
- é¡¹ç›® 2
  - å­é¡¹ç›® 2.1
  - å­é¡¹ç›® 2.2

### è¡¨æ ¼

| ç‰¹æ€§ | çŠ¶æ€ |
|------|------|
| åœ¨çº¿ç¼–è¾‘ | âœ… |
| KV å­˜å‚¨ | âœ… |
| æœç´¢åŠŸèƒ½ | âœ… |
| åˆ†å±é¢„è§ˆ | âœ… |

å¼€å§‹ç¼–è¾‘ä½ çš„æ–‡æ¡£å§!
`
    note = { body: defaultContent }
    note.parsed = await parseMarkdown(defaultContent)

    // ä¿å­˜åˆ° KV
    await kv.set(slug, note)
  }

  return { slug, ...note }
})
